# Doc-Researcher å®ç°æ€»ç»“

## ğŸ“¦ å·²å®Œæˆçš„æ–‡ä»¶

### 1. doc_researcher.py (æ ¸å¿ƒå®ç°)
**3000+ è¡Œä»£ç ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶:**

#### æ•°æ®ç»“æ„ç±»
- `Granularity`: æ£€ç´¢ç²’åº¦æšä¸¾ (chunk/page/full/summary)
- `LayoutType`: å¸ƒå±€ç±»å‹æšä¸¾ (text/table/figure/equation)
- `BoundingBox`: è¾¹ç•Œæ¡†ç±»ï¼Œæ”¯æŒé¢ç§¯è®¡ç®—å’Œé‡å ç‡è®¡ç®—
- `LayoutElement`: å¸ƒå±€å…ƒç´ ç±»ï¼Œå­˜å‚¨æ–‡æ¡£ä¸­çš„å„ç§å…ƒç´ 
- `Chunk`: æ–‡æ¡£å—ç±»ï¼ŒåŒ…å«å†…å®¹å’Œå¸ƒå±€ä¿¡æ¯
- `Document`: æ–‡æ¡£ç±»ï¼ŒåŒ…å«å…¨æ–‡ã€æ‘˜è¦ã€é¡µé¢å’Œå—ä¿¡æ¯
- `SearchResult`: æœç´¢ç»“æœç±»

#### æ ¸å¿ƒåŠŸèƒ½ç±»
- `MultimodalParser`: å¤šæ¨¡æ€æ–‡æ¡£è§£æå™¨
  - å¸ƒå±€æ„ŸçŸ¥è§£æ
  - è§†è§‰å…ƒç´ è½¬æ–‡æœ¬
  - æ™ºèƒ½åˆ†å—ç­–ç•¥
  - å¤šç²’åº¦è¡¨ç¤ºç”Ÿæˆ

- `RetrievalSystem`: å¤šæ¨¡æ€æ£€ç´¢ç³»ç»Ÿ
  - æ”¯æŒä¸‰ç§èŒƒå¼ (text/vision/hybrid)
  - å¤šç²’åº¦ç´¢å¼•
  - ç›¸ä¼¼åº¦è®¡ç®—

- `PlannerAgent`: è§„åˆ’å™¨æ™ºèƒ½ä½“
  - æ–‡æ¡£è¿‡æ»¤
  - ç²’åº¦é€‰æ‹©
  - å­æŸ¥è¯¢ç”Ÿæˆ

- `SearcherAgent`: æœç´¢å™¨æ™ºèƒ½ä½“
  - æ‰§è¡Œå¤šæ¨¡æ€æ£€ç´¢
  - å­æŸ¥è¯¢å¤„ç†

- `RefinerAgent`: ç²¾ç‚¼å™¨æ™ºèƒ½ä½“
  - ç»“æœå»é‡
  - ç›¸å…³æ€§è¿‡æ»¤
  - é‡æ–°æ’åº
  - ä¿¡æ¯å……åˆ†æ€§è¯„ä¼°

- `ReporterAgent`: æŠ¥å‘Šç”Ÿæˆå™¨æ™ºèƒ½ä½“
  - æ„å›¾åˆ†æ
  - è¯æ®ç»„ç»‡
  - æŠ¥å‘Šåˆæˆ
  - å¼•ç”¨æ ‡æ³¨

- `DocResearcher`: ä¸»ç³»ç»Ÿç±»
  - æ•´åˆæ‰€æœ‰ç»„ä»¶
  - è¿­ä»£æœç´¢-ç²¾ç‚¼å¾ªç¯
  - å¤šè½®å¯¹è¯æ”¯æŒ

### 2. examples.py (ä½¿ç”¨ç¤ºä¾‹)
åŒ…å«5ä¸ªå®Œæ•´ç¤ºä¾‹:
1. åŸºç¡€æ–‡æ¡£ç ”ç©¶
2. å¤šè½®å¯¹è¯ç ”ç©¶
3. æ–‡æ¡£è§£ææ¼”ç¤º
4. æ£€ç´¢ç³»ç»Ÿæ¼”ç¤º
5. å¤æ‚ç ”ç©¶åœºæ™¯

è¿˜åŒ…å«:
- ç³»ç»Ÿæ¶æ„è¯´æ˜
- æ ¸å¿ƒç‰¹æ€§ä»‹ç»
- æ€§èƒ½å¯¹æ¯”åˆ†æ
- ä¼˜åŒ–å»ºè®®

### 3. test_doc_researcher.py (æµ‹è¯•è„šæœ¬)
åŒ…å«6ä¸ªæµ‹è¯•:
1. è¾¹ç•Œæ¡†è®¡ç®—æµ‹è¯•
2. å¸ƒå±€å…ƒç´ æµ‹è¯•
3. æ™ºèƒ½åˆ†å—æµ‹è¯•
4. å¤šç²’åº¦æ£€ç´¢æµ‹è¯•
5. æ™ºèƒ½ä½“åä½œæµç¨‹æµ‹è¯•
6. ç«¯åˆ°ç«¯æµ‹è¯•

### 4. README.md (é¡¹ç›®æ–‡æ¡£)
å®Œæ•´çš„é¡¹ç›®æ–‡æ¡£ï¼ŒåŒ…å«:
- é¡¹ç›®ç®€ä»‹
- ç³»ç»Ÿæ¶æ„å›¾
- æ ¸å¿ƒç‰¹æ€§
- ä½¿ç”¨ç¤ºä¾‹
- æ€§èƒ½å¯¹æ¯”
- ä¼˜åŒ–å»ºè®®
- è®ºæ–‡å¼•ç”¨

## ğŸ¯ å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

### ç¦»çº¿é˜¶æ®µï¼šæ·±åº¦æ–‡æ¡£è§£æ

```python
# 1. å¸ƒå±€æ„ŸçŸ¥è§£æ
parser = MultimodalParser()
document = parser.parse_document("paper.pdf", "doc_001")

# ç”Ÿæˆçš„ç»“æœåŒ…å«:
# - å¸ƒå±€å…ƒç´ åˆ—è¡¨ (å¸¦è¾¹ç•Œæ¡†åæ ‡)
# - å¤šç²’åº¦è¡¨ç¤º (chunk/page/full/summary)
# - è§†è§‰å…ƒç´ çš„æ–‡æœ¬æè¿°
```

### åœ¨çº¿é˜¶æ®µï¼šæ·±åº¦ç ”ç©¶å·¥ä½œæµ

```python
# 2. æ™ºèƒ½è§„åˆ’
planner = PlannerAgent()
plan = planner.plan(query, history, documents)
# è¾“å‡º: è¿‡æ»¤çš„æ–‡æ¡£ã€é€‰æ‹©çš„ç²’åº¦ã€ç”Ÿæˆçš„å­æŸ¥è¯¢

# 3. è¿­ä»£æœç´¢-ç²¾ç‚¼å¾ªç¯
for iteration in range(max_iterations):
    results = searcher.search(subqueries, granularity, docs)
    refined = refiner.refine(results, query)
    sufficiency = refiner.evaluate_sufficiency(refined, query)
    
    if sufficiency >= threshold:
        break

# 4. ç”ŸæˆæŠ¥å‘Š
report = reporter.generate_report(query, refined, history)
```

## ğŸ“Š å…³é”®å®ç°ç»†èŠ‚

### 1. å¸ƒå±€æ„ŸçŸ¥åˆ†å—ç®—æ³•

```python
def _create_layout_aware_chunks(elements, doc_id):
    """
    æ ¸å¿ƒæ€æƒ³:
    1. æŒ‰é¡µé¢å’Œåºåˆ—IDæ’åº
    2. åœ¨sectionè¾¹ç•Œå¤„åˆ†å—
    3. ä¿æŒæœ€å¤§é•¿åº¦çº¦æŸ
    4. ä¿ç•™å®Œæ•´çš„å¸ƒå±€å…ƒç´ å¼•ç”¨
    """
    chunks = []
    current_elements = []
    current_length = 0
    
    for element in sorted_elements:
        if current_length + len(element.content) > max_length:
            # åˆ›å»ºæ–°å—
            chunks.append(finalize_chunk(current_elements))
            current_elements = []
            current_length = 0
        
        current_elements.append(element)
        current_length += len(element.content)
    
    return chunks
```

### 2. å¤šç²’åº¦æ£€ç´¢ç­–ç•¥

```python
def retrieve(query, granularity, top_k):
    """
    æ ¹æ®ç²’åº¦é€‰æ‹©ä¸åŒçš„æ£€ç´¢ç­–ç•¥:
    
    - CHUNK: ç»†ç²’åº¦ï¼Œé€‚åˆç²¾ç¡®å®šä½
    - PAGE: é¡µé¢çº§ï¼Œå¹³è¡¡ç²¾åº¦å’Œè¦†ç›–
    - FULL: å…¨æ–‡ï¼Œé€‚åˆæ–‡æ¡£çº§ä»»åŠ¡
    - SUMMARY: æ‘˜è¦ï¼Œé€‚åˆå¿«é€Ÿç­›é€‰
    """
    results = []
    for key, item in index.items():
        if item['type'] == granularity.value:
            score = compute_similarity(query, item['content'])
            results.append({'score': score, 'item': item})
    
    return sorted(results, reverse=True)[:top_k]
```

### 3. è¿­ä»£ç ”ç©¶å¾ªç¯

```python
def research(query):
    """
    æ ¸å¿ƒå·¥ä½œæµ:
    
    1. Planner: åˆ†ææŸ¥è¯¢ï¼Œé€‰æ‹©ç­–ç•¥
    2. è¿­ä»£å¾ªç¯:
       - Searcher: æ‰§è¡Œæ£€ç´¢
       - Refiner: ç²¾ç‚¼ç»“æœ
       - è¯„ä¼°: æ£€æŸ¥ä¿¡æ¯å……åˆ†æ€§
       - å¦‚æœä¸è¶³: ç”Ÿæˆæ–°æŸ¥è¯¢
    3. Reporter: ç»¼åˆè¯æ®ï¼Œç”ŸæˆæŠ¥å‘Š
    """
    plan = planner.plan(query, history, documents)
    
    all_results = []
    iteration = 0
    sufficiency = 0.0
    
    while iteration < max_iterations and sufficiency < threshold:
        results = searcher.search(plan['subqueries'], ...)
        refined = refiner.refine(results, query)
        all_results.extend(refined)
        
        sufficiency = refiner.evaluate_sufficiency(all_results, query)
        iteration += 1
    
    report = reporter.generate_report(query, all_results, history)
    return report
```

## ğŸ’¡ åˆ›æ–°ç‚¹å®ç°

### 1. æ·±åº¦å¤šæ¨¡æ€è§£æ
âœ… ä¿ç•™å¸ƒå±€ç»“æ„ (è¾¹ç•Œæ¡†åæ ‡)
âœ… è§†è§‰å…ƒç´ è½¬æ–‡æœ¬ (VLMæè¿°)
âœ… å¤šç²’åº¦è¡¨ç¤º (4ç§ç²’åº¦)
âœ… æ™ºèƒ½åˆ†å— (å¸ƒå±€æ„ŸçŸ¥)

### 2. ç³»ç»ŸåŒ–æ£€ç´¢æ¶æ„
âœ… ä¸‰ç§èŒƒå¼ (text/vision/hybrid)
âœ… è‡ªé€‚åº”ç²’åº¦é€‰æ‹©
âœ… å¤šæŸ¥è¯¢èšåˆ

### 3. æ·±åº¦ç ”ç©¶å·¥ä½œæµ
âœ… æ™ºèƒ½è§„åˆ’ (æ–‡æ¡£è¿‡æ»¤+ç²’åº¦é€‰æ‹©+å­æŸ¥è¯¢ç”Ÿæˆ)
âœ… è¿­ä»£å¾ªç¯ (æœç´¢-ç²¾ç‚¼-è¯„ä¼°)
âœ… æ¸è¿›å¼è¯æ®ç§¯ç´¯
âœ… å¤šè½®å¯¹è¯æ”¯æŒ

## ğŸš€ æ€§èƒ½ç‰¹ç‚¹

### æ—¶é—´å¤æ‚åº¦
- **è§£æé˜¶æ®µ**: O(N Ã— P) 
  - N: æ–‡æ¡£æ•°
  - P: æ¯ä¸ªæ–‡æ¡£çš„é¡µé¢æ•°

- **æ£€ç´¢é˜¶æ®µ**: O(Q Ã— K Ã— log(M))
  - Q: æŸ¥è¯¢æ•°
  - K: top-k
  - M: ç´¢å¼•å¤§å°

- **ç ”ç©¶é˜¶æ®µ**: O(I Ã— (Q + R))
  - I: è¿­ä»£æ¬¡æ•°
  - Q: æŸ¥è¯¢å¤„ç†æ—¶é—´
  - R: ç»“æœç²¾ç‚¼æ—¶é—´

### ç©ºé—´å¤æ‚åº¦
- **æ–‡æ¡£å­˜å‚¨**: O(N Ã— P Ã— E)
  - E: æ¯é¡µçš„å…ƒç´ æ•°
- **ç´¢å¼•å­˜å‚¨**: O(N Ã— P Ã— D)
  - D: åµŒå…¥ç»´åº¦

## ğŸ“ˆ æ‰©å±•æ€§

### 1. å¯æ›¿æ¢çš„ç»„ä»¶
- è§£æå™¨: å¯æ›¿æ¢ä¸ºå…¶ä»–PDFè§£æå·¥å…·
- åµŒå…¥æ¨¡å‹: æ”¯æŒä»»æ„æ–‡æœ¬/è§†è§‰åµŒå…¥æ¨¡å‹
- LLM: å¯ä½¿ç”¨ä¸åŒçš„å¤§è¯­è¨€æ¨¡å‹
- å‘é‡æ•°æ®åº“: å¯é›†æˆFAISSã€Milvusç­‰

### 2. å¯å®šåˆ¶çš„ç­–ç•¥
- åˆ†å—ç­–ç•¥: å¯æ ¹æ®æ–‡æ¡£ç±»å‹è°ƒæ•´
- æ£€ç´¢ç­–ç•¥: å¯å®ç°è‡ªå®šä¹‰ç›¸ä¼¼åº¦è®¡ç®—
- è§„åˆ’ç­–ç•¥: å¯å®ç°ä¸åŒçš„ç²’åº¦é€‰æ‹©é€»è¾‘
- è¯„ä¼°ç­–ç•¥: å¯è‡ªå®šä¹‰ä¿¡æ¯å……åˆ†æ€§è¯„ä¼°

### 3. å¯æ‰©å±•çš„åŠŸèƒ½
- æ”¯æŒæ›´å¤šæ–‡æ¡£æ ¼å¼
- æ·»åŠ æ›´å¤šæ¨¡æ€ (éŸ³é¢‘ã€è§†é¢‘)
- å®ç°æ›´å¤æ‚çš„æ¨ç†é“¾
- é›†æˆå¤–éƒ¨çŸ¥è¯†åº“

## ğŸ”§ ç”Ÿäº§éƒ¨ç½²å»ºè®®

### 1. é›†æˆçœŸå®å·¥å…·
```python
# MinerU for parsing
from mineru import DocumentParser

# Qwen2.5-VL for vision
from qwen_vl import VisionLanguageModel

# FAISS for vector search
import faiss

# Sentence transformers
from sentence_transformers import SentenceTransformer
```

### 2. æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨GPUåŠ é€ŸåµŒå…¥è®¡ç®—
- å®ç°æ‰¹é‡å¤„ç†
- æ·»åŠ ç»“æœç¼“å­˜
- ä½¿ç”¨å¼‚æ­¥IO

### 3. ç›‘æ§å’Œæ—¥å¿—
- è®°å½•å¤„ç†æ—¶é—´
- ç›‘æ§å†…å­˜ä½¿ç”¨
- è¿½è¸ªæ£€ç´¢è´¨é‡
- è®°å½•é”™è¯¯ä¿¡æ¯

### 4. APIè®¾è®¡
```python
# RESTful API
POST /api/v1/documents          # ä¸Šä¼ æ–‡æ¡£
GET  /api/v1/documents/{id}     # è·å–æ–‡æ¡£
POST /api/v1/research           # æ‰§è¡Œç ”ç©¶
GET  /api/v1/research/{id}      # è·å–ç ”ç©¶ç»“æœ
```

## ğŸ“š è®ºæ–‡å¯¹ç…§

| è®ºæ–‡ç« èŠ‚ | å®ç°ä½ç½® | å®Œæˆåº¦ |
|---------|---------|--------|
| 3.1 Deep Multimodal Parsing | `MultimodalParser` | âœ… æ ¸å¿ƒç®—æ³•å®Œæˆ |
| 3.2 Multimodal Retrieval | `RetrievalSystem` | âœ… ä¸‰ç§èŒƒå¼å®ç° |
| 3.3 Deep Research Workflows | `DocResearcher` | âœ… å®Œæ•´æµç¨‹å®ç° |
| 4 M4DocBench | - | âš ï¸ éœ€çœŸå®æ•°æ®é›† |
| 5 Experiments | `test_doc_researcher.py` | âœ… æµ‹è¯•æ¡†æ¶å®Œæˆ |

## âœ… å·²æµ‹è¯•åŠŸèƒ½

1. âœ… è¾¹ç•Œæ¡†è®¡ç®—å’Œé‡å æ£€æµ‹
2. âœ… å¸ƒå±€å…ƒç´ åˆ›å»ºå’Œç®¡ç†
3. âœ… æ™ºèƒ½åˆ†å—ç®—æ³•
4. âœ… å¤šç²’åº¦ç´¢å¼•å’Œæ£€ç´¢
5. âœ… æ™ºèƒ½ä½“åä½œæµç¨‹
6. âœ… ç«¯åˆ°ç«¯ç ”ç©¶å·¥ä½œæµ

## ğŸ“ ä½¿ç”¨å»ºè®®

### é€‚åˆåœºæ™¯
- å¤šæ–‡æ¡£ç»¼åˆåˆ†æ
- è·¨æ¨¡æ€ä¿¡æ¯æ£€ç´¢
- æ·±åº¦ç ”ç©¶ä»»åŠ¡
- çŸ¥è¯†å‘ç°

### ä¸é€‚åˆåœºæ™¯
- å®æ—¶é—®ç­” (éœ€è¦é¢„å¤„ç†æ—¶é—´)
- ç®€å•æŸ¥è¯¢ (è¿‡åº¦è®¾è®¡)
- å°è§„æ¨¡æ•°æ® (æˆæœ¬è¾ƒé«˜)

### æœ€ä½³å®è·µ
1. é¢„å…ˆè§£æå’Œç´¢å¼•æ‰€æœ‰æ–‡æ¡£
2. æ ¹æ®æŸ¥è¯¢ç±»å‹é€‰æ‹©åˆé€‚çš„ç²’åº¦
3. è®¾ç½®åˆç†çš„è¿­ä»£æ¬¡æ•°å’Œé˜ˆå€¼
4. åˆ©ç”¨ç¼“å­˜æé«˜æ•ˆç‡
5. ç›‘æ§ç³»ç»Ÿæ€§èƒ½

## ğŸ“ å­¦ä¹ ä»·å€¼

è¿™ä¸ªå®ç°å±•ç¤ºäº†:
- å¤šæ¨¡æ€æ–‡æ¡£å¤„ç†çš„å®Œæ•´æµç¨‹
- å¤šæ™ºèƒ½ä½“åä½œçš„è®¾è®¡æ¨¡å¼
- è¿­ä»£å¼ä¿¡æ¯æ£€ç´¢çš„å®ç°
- å¤æ‚ç³»ç»Ÿçš„æ¨¡å—åŒ–è®¾è®¡

## ğŸ“– å‚è€ƒèµ„æ–™

- åŸå§‹è®ºæ–‡: arXiv:2510.21603
- MinerUæ–‡æ¡£è§£æå·¥å…·
- RAGç³»ç»Ÿè®¾è®¡æœ€ä½³å®è·µ
- å¤šæ¨¡æ€æ£€ç´¢æŠ€æœ¯

---

**é¡¹ç›®çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œå¯ç”¨äºå­¦ä¹ å’ŒåŸå‹å¼€å‘

**ä¸‹ä¸€æ­¥**: é›†æˆçœŸå®å·¥å…·ï¼Œè¿›è¡Œç”Ÿäº§ç¯å¢ƒæµ‹è¯•
