# Doc-Researcher: å¤šæ¨¡æ€æ–‡æ¡£è§£æå’Œæ·±åº¦ç ”ç©¶ç³»ç»Ÿ

åŸºäºè®ºæ–‡å®ç°ï¼š*"Doc-Researcher: A Unified System for Multimodal Document Parsing and Deep Research"*

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

Doc-Researcher æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ç³»ç»Ÿï¼Œç”¨äºå¤šæ¨¡æ€æ–‡æ¡£è§£æå’Œæ·±åº¦ç ”ç©¶ã€‚å®ƒè§£å†³äº†ç°æœ‰æ·±åº¦ç ”ç©¶ç³»ç»Ÿçš„ä¸‰ä¸ªå…³é”®é™åˆ¶ï¼š

1. **ä¸å……åˆ†çš„å¤šæ¨¡æ€è§£æ** - ä¼ ç»Ÿæ–¹æ³•æ— æ³•ä¿ç•™å›¾è¡¨ã€è¡¨æ ¼å’Œå¤æ‚å¸ƒå±€çš„è§†è§‰è¯­ä¹‰
2. **æœ‰é™çš„æ£€ç´¢ç­–ç•¥** - ç¼ºä¹è·¨æ¨¡æ€å’Œå¤šç²’åº¦çš„è‡ªé€‚åº”æ£€ç´¢æœºåˆ¶
3. **ç¼ºä¹æ·±åº¦ç ”ç©¶èƒ½åŠ›** - ä»…æ”¯æŒå•è½®é—®ç­”ï¼Œä¸æ”¯æŒè¿­ä»£å¤šæ­¥ç ”ç©¶å·¥ä½œæµ

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Doc-Researcher ç³»ç»Ÿ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€ç¦»çº¿é˜¶æ®µã€‘æ–‡æ¡£è§£æå’Œç´¢å¼•
â”œâ”€â”€ MultimodalParser: æ·±åº¦å¤šæ¨¡æ€è§£æ
â”‚   â”œâ”€â”€ å¸ƒå±€æ„ŸçŸ¥è§£æ (MinerU)
â”‚   â”œâ”€â”€ è§†è§‰å…ƒç´ è½¬æ–‡æœ¬ (VLM)
â”‚   â”‚   â”œâ”€â”€ å›¾ç‰‡ â†’ æè¿°
â”‚   â”‚   â”œâ”€â”€ è¡¨æ ¼ â†’ ç»“æ„åŒ–æ–‡æœ¬
â”‚   â”‚   â””â”€â”€ å…¬å¼ â†’ LaTeX
â”‚   â””â”€â”€ æ™ºèƒ½åˆ†å— + å¤šç²’åº¦è¡¨ç¤º
â”‚
â””â”€â”€ RetrievalSystem: å¤šæ¨¡æ€æ£€ç´¢
    â”œâ”€â”€ Text-only æ£€ç´¢
    â”œâ”€â”€ Vision-only æ£€ç´¢
    â””â”€â”€ Hybrid æ··åˆæ£€ç´¢

ã€åœ¨çº¿é˜¶æ®µã€‘æ·±åº¦ç ”ç©¶å·¥ä½œæµ
â”œâ”€â”€ PlannerAgent: æ™ºèƒ½è§„åˆ’
â”‚   â”œâ”€â”€ æ–‡æ¡£è¿‡æ»¤
â”‚   â”œâ”€â”€ ç²’åº¦é€‰æ‹©
â”‚   â””â”€â”€ å­æŸ¥è¯¢ç”Ÿæˆ
â”‚
â”œâ”€â”€ è¿­ä»£å¾ªç¯ (æœ€å¤šNæ¬¡)
â”‚   â”œâ”€â”€ SearcherAgent: æ‰§è¡Œæ£€ç´¢
â”‚   â”œâ”€â”€ RefinerAgent: ç²¾ç‚¼ç»“æœ
â”‚   â””â”€â”€ è¯„ä¼°ä¿¡æ¯å……åˆ†æ€§
â”‚
â””â”€â”€ ReporterAgent: ç”ŸæˆæŠ¥å‘Š
    â”œâ”€â”€ è¯æ®ç»„ç»‡
    â”œâ”€â”€ ç­”æ¡ˆåˆæˆ
    â””â”€â”€ å¼•ç”¨æ ‡æ³¨
```

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### 1. æ·±åº¦å¤šæ¨¡æ€è§£æ
- âœ… ä¿ç•™å¸ƒå±€ç»“æ„å’Œè§†è§‰è¯­ä¹‰
- âœ… å¤„ç†æ–‡æœ¬ã€è¡¨æ ¼ã€å›¾ç‰‡ã€å…¬å¼
- âœ… å¤šç²’åº¦è¡¨ç¤º (chunk/page/full/summary)
- âœ… ç²¾ç¡®ä½ç½®å®šä½ (è¾¹ç•Œæ¡†åæ ‡)

### 2. ç³»ç»ŸåŒ–æ£€ç´¢æ¶æ„
- âœ… ä¸‰ç§æ£€ç´¢èŒƒå¼ï¼šText-only / Vision-only / Hybrid
- âœ… è‡ªé€‚åº”ç²’åº¦é€‰æ‹©
- âœ… å¤šæŸ¥è¯¢èšåˆå’Œé‡æ’åº

### 3. æ·±åº¦ç ”ç©¶å·¥ä½œæµ
- âœ… æ™ºèƒ½æŸ¥è¯¢è§„åˆ’
- âœ… è¿­ä»£æœç´¢-ç²¾ç‚¼å¾ªç¯
- âœ… æ¸è¿›å¼è¯æ®ç§¯ç´¯
- âœ… ä¿¡æ¯å……åˆ†æ€§è¯„ä¼°
- âœ… å¤šè½®å¯¹è¯æ”¯æŒ

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶

### ç±»å’Œæ•°æ®ç»“æ„

```python
# æšä¸¾ç±»
- Granularity: æ£€ç´¢ç²’åº¦ (CHUNK/PAGE/FULL/SUMMARY)
- LayoutType: å¸ƒå±€ç±»å‹ (TEXT/TABLE/FIGURE/EQUATION)

# æ•°æ®ç±»
- BoundingBox: è¾¹ç•Œæ¡†
- LayoutElement: å¸ƒå±€å…ƒç´ 
- Chunk: æ–‡æ¡£å—
- Document: æ–‡æ¡£
- SearchResult: æœç´¢ç»“æœ

# æ ¸å¿ƒç±»
- MultimodalParser: å¤šæ¨¡æ€è§£æå™¨
- RetrievalSystem: æ£€ç´¢ç³»ç»Ÿ
- PlannerAgent: è§„åˆ’å™¨æ™ºèƒ½ä½“
- SearcherAgent: æœç´¢å™¨æ™ºèƒ½ä½“
- RefinerAgent: ç²¾ç‚¼å™¨æ™ºèƒ½ä½“
- ReporterAgent: æŠ¥å‘Šç”Ÿæˆå™¨æ™ºèƒ½ä½“
- DocResearcher: ä¸»ç³»ç»Ÿ
```

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```python
from doc_researcher import DocResearcher

# 1. åˆ›å»ºç³»ç»Ÿ
researcher = DocResearcher(
    max_iterations=5,           # æœ€å¤§è¿­ä»£æ¬¡æ•°
    sufficiency_threshold=0.7   # ä¿¡æ¯å……åˆ†æ€§é˜ˆå€¼
)

# 2. æ·»åŠ æ–‡æ¡£
documents = [
    "paper1.pdf",
    "report.pdf",
    "analysis.pdf"
]
researcher.add_documents(documents)

# 3. æ‰§è¡Œç ”ç©¶
query = "è¿™äº›æ–‡æ¡£è®¨è®ºçš„ä¸»è¦æŠ€æœ¯æ˜¯ä»€ä¹ˆ?"
report = researcher.research(query)
print(report)
```

### å¤šè½®å¯¹è¯

```python
# ç¬¬ä¸€è½®
report1 = researcher.research("æ–‡æ¡£ä¸­çš„ä¿é™©ä¿è´¹æ˜¯å¤šå°‘?")

# ç¬¬äºŒè½® (åŸºäºå¯¹è¯å†å²)
report2 = researcher.research("å¦‚æœé€‰æ‹©éé¢æ¿åŒ»é™¢ä¼šæ€æ ·?")
```

### æ–‡æ¡£è§£æ

```python
from doc_researcher import MultimodalParser

parser = MultimodalParser(max_chunk_length=512)
document = parser.parse_document("example.pdf", "doc_001")

print(f"é¡µé¢æ•°: {len(document.pages)}")
print(f"å—æ•°é‡: {len(document.chunks)}")
print(f"å¸ƒå±€å…ƒç´ : {len(document.layout_elements)}")
```

### å¤šç²’åº¦æ£€ç´¢

```python
from doc_researcher import RetrievalSystem, Granularity

retrieval = RetrievalSystem(paradigm="hybrid")
retrieval.index_document(document)

# ä¸åŒç²’åº¦çš„æ£€ç´¢
chunk_results = retrieval.retrieve(query, Granularity.CHUNK, top_k=5)
page_results = retrieval.retrieve(query, Granularity.PAGE, top_k=5)
summary_results = retrieval.retrieve(query, Granularity.SUMMARY, top_k=5)
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| ç³»ç»Ÿ | è§£æ | æ£€ç´¢ | è¿­ä»£ | å‡†ç¡®ç‡ |
|------|------|------|------|--------|
| Direct (æ— RAG) | - | - | - | 5-10% |
| Long-context | Shallow | - | - | 9-32% |
| MDocAgent | Shallow | Hybrid | âœ— | 15.8% |
| M3DocRAG | Free | Vision | âœ— | 7.0% |
| **Doc-Researcher** | **Deep** | **Hybrid** | **âœ“** | **50.6%** |

### å…³é”®å‘ç°

1. **æ·±åº¦è§£æçš„é‡è¦æ€§**: Deepè§£ææ¯”Shallowè§£ææå‡ +11.4%
2. **è¿­ä»£å·¥ä½œæµçš„ä»·å€¼**: æ¯”å•è½®æ£€ç´¢æå‡ 3.4å€
3. **æ··åˆæ£€ç´¢çš„ä¼˜åŠ¿**: æ¯”å•æ¨¡æ€æ£€ç´¢æå‡ 3-5%
4. **è§„åˆ’å™¨çš„ä½œç”¨**: æœ‰è§„åˆ’å™¨æ¯”æ— è§„åˆ’å™¨æå‡ 8.3%

## ğŸ¯ M4DocBench åŸºå‡†

è®ºæ–‡å¼•å…¥äº†é¦–ä¸ªå¤šæ¨¡æ€æ–‡æ¡£æ·±åº¦ç ”ç©¶åŸºå‡†ï¼š

- **Multi-modal**: è·¨æ¨¡æ€è¯æ® (æ–‡æœ¬/è¡¨æ ¼/å›¾ç‰‡)
- **Multi-hop**: å¤šè·³æ¨ç†
- **Multi-document**: å¤šæ–‡æ¡£ç»¼åˆ (å¹³å‡12.7ä¸ªæ–‡æ¡£)
- **Multi-turn**: å¤šè½®äº¤äº’

ç»Ÿè®¡æ•°æ®ï¼š
- 158ä¸ªä¸“å®¶æ ‡æ³¨çš„é—®é¢˜
- 304ä¸ªæ–‡æ¡£ï¼Œ6,177é¡µ
- å¹³å‡æ¯é—®é¢˜: 3.8ä¸ªç›¸å…³æ–‡æ¡£ï¼Œ7.0ä¸ªç›¸å…³é¡µé¢ï¼Œ14.8ä¸ªå¸ƒå±€å…ƒç´ 
- æ”¯æŒä¸­è‹±æ–‡åŒè¯­

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### è§£æé˜¶æ®µ
1. **ä¸€æ¬¡æ€§é¢„å¤„ç†**: é¿å…é‡å¤å¤„ç†è§†è§‰å…ƒç´ 
2. **æ‰¹é‡å¤„ç†**: æ‰¹é‡è°ƒç”¨VLM API
3. **ç¼“å­˜ç­–ç•¥**: ç¼“å­˜è§£æç»“æœ

### æ£€ç´¢é˜¶æ®µ
1. **å‘é‡ç´¢å¼•**: ä½¿ç”¨FAISSã€Milvusç­‰
2. **æ··åˆæ£€ç´¢**: ç»“åˆBM25å’Œembedding
3. **é‡åŒ–å‹ç¼©**: å‡å°‘å‘é‡å­˜å‚¨
4. **GPUåŠ é€Ÿ**: æ‰¹é‡åµŒå…¥è®¡ç®—

### ç ”ç©¶é˜¶æ®µ
1. **æ—©åœç­–ç•¥**: ä¿¡æ¯å……åˆ†æ—¶æå‰ç»ˆæ­¢
2. **å¹¶è¡Œå¤„ç†**: å¹¶è¡Œæ‰§è¡Œå­æŸ¥è¯¢
3. **å¢é‡æ›´æ–°**: é¿å…é‡å¤å¤„ç†
4. **ä¸Šä¸‹æ–‡ç®¡ç†**: æ™ºèƒ½æˆªæ–­å†å²

### æ•ˆç‡åˆ†æ

| é˜¶æ®µ | æ·±åº¦è§£æ | è§£æå…è´¹ |
|------|---------|---------|
| è§£ææ—¶é—´ | ~2.5å°æ—¶ | ~9-39åˆ†é’Ÿ |
| ç ”ç©¶æ—¶é—´ | ~4å°æ—¶ | ~20å°æ—¶ |
| **æ€»æ—¶é—´** | ~6.5å°æ—¶ | ~20.5å°æ—¶ |

æ·±åº¦è§£æè™½ç„¶å‰æœŸæ…¢ï¼Œä½†ç ”ç©¶é˜¶æ®µå¿«5å€ï¼Œæ€»ä½“æ›´é«˜æ•ˆï¼

## ğŸ”§ æ‰©å±•å’Œå®šåˆ¶

### æ›¿æ¢è§£æå™¨

```python
class CustomParser(MultimodalParser):
    def _extract_layout_elements(self, doc_path, doc_id):
        # ä½¿ç”¨è‡ªå®šä¹‰çš„è§£æå·¥å…·
        # å¦‚: PyMuPDF, pdfplumberç­‰
        pass
```

### è‡ªå®šä¹‰æ£€ç´¢å™¨

```python
class CustomRetrieval(RetrievalSystem):
    def _compute_similarity(self, query, content):
        # ä½¿ç”¨è‡ªå®šä¹‰çš„ç›¸ä¼¼åº¦è®¡ç®—
        # å¦‚: Sentence-BERT, ColBERTç­‰
        pass
```

### è‡ªå®šä¹‰æ™ºèƒ½ä½“

```python
class CustomPlanner(PlannerAgent):
    def _select_granularity(self, query, history):
        # å®ç°è‡ªå®šä¹‰çš„ç²’åº¦é€‰æ‹©ç­–ç•¥
        pass
```

## ğŸ“š è®ºæ–‡å¼•ç”¨

```bibtex
@article{dong2025docresearcher,
  title={Doc-Researcher: A Unified System for Multimodal Document Parsing and Deep Research},
  author={Dong, Kuicai and Huang, Shurui and Ye, Fangda and Han, Wei and Zhang, Zhi and Li, Dexun and Li, Wenjun and Yang, Qu and Wang, Gang and Wang, Yichao and Zhang, Chen and Liu, Yong},
  journal={arXiv preprint arXiv:2510.21603},
  year={2025}
}
```

## ğŸ”— ç›¸å…³é“¾æ¥

- è®ºæ–‡: [arXiv:2510.21603](https://arxiv.org/abs/2510.21603)
- MinerU: å¸ƒå±€æ„ŸçŸ¥æ–‡æ¡£è§£æå·¥å…·
- M4DocBench: å¤šæ¨¡æ€æ–‡æ¡£ç ”ç©¶åŸºå‡†

## ğŸ“ å®ç°è¯´æ˜

è¿™æ˜¯åŸºäºè®ºæ–‡çš„ç®€åŒ–å®ç°ï¼ŒåŒ…å«äº†æ ¸å¿ƒæ¶æ„å’Œç®—æ³•æµç¨‹ã€‚å®é™…ç”Ÿäº§ç¯å¢ƒéœ€è¦ï¼š

1. **é›†æˆçœŸå®å·¥å…·**:
   - MinerUç”¨äºæ–‡æ¡£è§£æ
   - Qwen2.5-VLç”¨äºè§†è§‰ç†è§£
   - UniMERNetç”¨äºå…¬å¼è¯†åˆ«
   - å‘é‡æ•°æ®åº“ (FAISS/Milvus)
   - åµŒå…¥æ¨¡å‹ (BGE-M3, Jina-v4ç­‰)

2. **å®Œå–„åŠŸèƒ½**:
   - å®Œæ•´çš„é”™è¯¯å¤„ç†
   - å¼‚æ­¥å¹¶å‘å¤„ç†
   - ç¼“å­˜å’ŒæŒä¹…åŒ–
   - ç›‘æ§å’Œæ—¥å¿—
   - APIæ¥å£

3. **ä¼˜åŒ–æ€§èƒ½**:
   - GPUåŠ é€Ÿ
   - æ‰¹é‡å¤„ç†
   - æ¨¡å‹é‡åŒ–
   - åˆ†å¸ƒå¼éƒ¨ç½²

## ğŸ“„ æ–‡ä»¶è¯´æ˜

- `doc_researcher.py`: æ ¸å¿ƒç³»ç»Ÿå®ç°
- `examples.py`: ä½¿ç”¨ç¤ºä¾‹å’Œæ¼”ç¤º
- `README.md`: é¡¹ç›®æ–‡æ¡£

## ğŸ™ è‡´è°¢

æœ¬å®ç°åŸºäºåä¸ºæŠ€æœ¯æœ‰é™å…¬å¸å›¢é˜Ÿçš„ç ”ç©¶å·¥ä½œã€‚æ„Ÿè°¢ä½œè€…ä»¬çš„å¼€åˆ›æ€§è´¡çŒ®ï¼

---

**æ³¨**: è¿™æ˜¯ä¸€ä¸ªæ•™è‚²å’Œç ”ç©¶ç”¨é€”çš„å®ç°ã€‚å¦‚éœ€ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œè¯·å‚è€ƒè®ºæ–‡è¿›è¡Œå®Œæ•´å®ç°ã€‚
