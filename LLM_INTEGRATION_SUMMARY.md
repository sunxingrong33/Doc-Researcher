# Doc-Researcher LLMé›†æˆ - å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. LLMå®¢æˆ·ç«¯å°è£… (llm_client.py)

**åŠŸèƒ½å®Œæ•´çš„APIå®¢æˆ·ç«¯ï¼ŒåŒ…å«:**

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… åŸºç¡€å¯¹è¯æ¥å£ (`chat()`)
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… è¶…æ—¶æ§åˆ¶
- âœ… JSONå“åº”è§£æ

#### ä¸“ä¸šåŠŸèƒ½
- âœ… è¡¨æ ¼æè¿°ç”Ÿæˆ (`generate_table_description()`)
- âœ… å›¾ç‰‡æè¿°ç”Ÿæˆ (`generate_figure_description()`)  
- âœ… æ–‡æ¡£æ‘˜è¦ç”Ÿæˆ (`generate_summary()`)
- âœ… æŸ¥è¯¢æ„å›¾åˆ†æ (`analyze_query_intent()`)
- âœ… å­æŸ¥è¯¢ç”Ÿæˆ (`generate_subqueries()`)
- âœ… ä¿¡æ¯å……åˆ†æ€§è¯„ä¼° (`evaluate_information_sufficiency()`)
- âœ… ç ”ç©¶æŠ¥å‘Šç”Ÿæˆ (`generate_report()`)

**ä»£ç ç»Ÿè®¡:**
- çº¦500è¡ŒPythonä»£ç 
- 8ä¸ªä¸»è¦APIæ–¹æ³•
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š

### 2. LLMé›†æˆç³»ç»Ÿ (doc_researcher_with_llm.py)

**åŸºäºåŸå§‹å®ç°ï¼Œé›†æˆçœŸå®LLM API:**

#### ç»„ä»¶å‡çº§
- âœ… `LLMMultimodalParser` - ä½¿ç”¨LLMç”Ÿæˆæè¿°
- âœ… `LLMPlannerAgent` - ä½¿ç”¨LLMåˆ†æå’Œè§„åˆ’
- âœ… `LLMRefinerAgent` - ä½¿ç”¨LLMè¯„ä¼°å……åˆ†æ€§
- âœ… `LLMReporterAgent` - ä½¿ç”¨LLMç”ŸæˆæŠ¥å‘Š
- âœ… `LLMDocResearcher` - å®Œæ•´çš„ä¸»ç³»ç»Ÿ

#### å·¥ä½œæµç¨‹
```
æ–‡æ¡£è§£æ â†’ LLMç”Ÿæˆæè¿° â†’ ç´¢å¼•
    â†“
ç”¨æˆ·æŸ¥è¯¢ â†’ LLMåˆ†ææ„å›¾ â†’ LLMç”Ÿæˆå­æŸ¥è¯¢
    â†“
è¿­ä»£æ£€ç´¢ â†’ LLMè¯„ä¼°å……åˆ†æ€§
    â†“
LLMç”ŸæˆæŠ¥å‘Š â†’ è¿”å›ç”¨æˆ·
```

**ä»£ç ç»Ÿè®¡:**
- çº¦400è¡ŒPythonä»£ç 
- 5ä¸ªé›†æˆLLMçš„ç±»
- å®Œæ•´çš„æ¼”ç¤ºä»£ç 

### 3. APIæµ‹è¯•å·¥å…· (test_llm_api.py)

**å…¨é¢çš„æµ‹è¯•å¥—ä»¶:**

#### æµ‹è¯•é¡¹ç›®
1. âœ… åŸºæœ¬è¿æ¥æµ‹è¯•
2. âœ… è¡¨æ ¼æè¿°ç”Ÿæˆæµ‹è¯•
3. âœ… æ‘˜è¦ç”Ÿæˆæµ‹è¯•
4. âœ… æŸ¥è¯¢æ„å›¾åˆ†ææµ‹è¯•
5. âœ… å­æŸ¥è¯¢ç”Ÿæˆæµ‹è¯•
6. âœ… æŠ¥å‘Šç”Ÿæˆæµ‹è¯•

**ä½¿ç”¨æ–¹æ³•:**
```bash
# å¿«é€Ÿæµ‹è¯•è¿æ¥
python test_llm_api.py basic

# è¿è¡Œå®Œæ•´æµ‹è¯•
python test_llm_api.py
```

**ä»£ç ç»Ÿè®¡:**
- çº¦230è¡ŒPythonä»£ç 
- 6ä¸ªç‹¬ç«‹æµ‹è¯•å‡½æ•°
- æµ‹è¯•ç»“æœæ±‡æ€»

### 4. ä½¿ç”¨æ–‡æ¡£ (LLM_INTEGRATION_GUIDE.md)

**è¯¦ç»†çš„é›†æˆæŒ‡å—ï¼ŒåŒ…å«:**

- ğŸ“– å¿«é€Ÿå¼€å§‹æŒ‡å—
- ğŸ”§ APIé…ç½®è¯´æ˜
- ğŸ“Š æ‰€æœ‰åŠŸèƒ½çš„è¯¦ç»†è¯´æ˜å’Œç¤ºä¾‹
- ğŸ’¡ ä½¿ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µ
- ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®
- ğŸ› å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- ğŸ” è°ƒè¯•æŠ€å·§

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

1. **llm_client.py** (500è¡Œ)
   - LLM APIå®¢æˆ·ç«¯å°è£…
   - 8ä¸ªä¸“ä¸šåŠŸèƒ½æ–¹æ³•
   - å®Œæ•´çš„é”™è¯¯å¤„ç†

2. **doc_researcher_with_llm.py** (400è¡Œ)
   - é›†æˆLLMçš„å®Œæ•´ç³»ç»Ÿ
   - 5ä¸ªå‡çº§çš„ç»„ä»¶ç±»
   - å¯è¿è¡Œçš„æ¼”ç¤ºä»£ç 

3. **test_llm_api.py** (230è¡Œ)
   - 6ä¸ªæµ‹è¯•å‡½æ•°
   - æµ‹è¯•ç»“æœæ±‡æ€»
   - å‘½ä»¤è¡Œæ¥å£

4. **LLM_INTEGRATION_GUIDE.md** (å®Œæ•´æ–‡æ¡£)
   - ä½¿ç”¨è¯´æ˜
   - APIå‚è€ƒ
   - æœ€ä½³å®è·µ
   - æ•…éšœæ’é™¤

### åŸæœ‰æ–‡ä»¶ï¼ˆä¿æŒä¸å˜ï¼‰

- doc_researcher.py - åŸºç¡€å®ç°
- examples.py - ä½¿ç”¨ç¤ºä¾‹  
- test_doc_researcher.py - åŸºç¡€æµ‹è¯•
- README.md - é¡¹ç›®æ–‡æ¡£
- SUMMARY.md - å®ç°æ€»ç»“

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### 1. çœŸå®LLMé›†æˆ

**ä¹‹å‰:** æ¨¡æ‹Ÿçš„ç®€å•é€»è¾‘
```python
def generate_summary(text):
    return f"è¿™æ˜¯ä¸€ä¸ªæ‘˜è¦...({len(text)}å­—ç¬¦)"
```

**ç°åœ¨:** çœŸå®çš„LLM APIè°ƒç”¨
```python
def generate_summary(text):
    return self.llm.generate_summary(text, max_length=500)
    # è°ƒç”¨çœŸå®çš„Qwen3 APIï¼Œè¿”å›é«˜è´¨é‡æ‘˜è¦
```

### 2. æ™ºèƒ½æŸ¥è¯¢åˆ†æ

**ä¹‹å‰:** åŸºäºå…³é”®è¯çš„ç®€å•è§„åˆ™
```python
if "æ¯”è¾ƒ" in query:
    return "comparison"
```

**ç°åœ¨:** LLMæ·±åº¦ç†è§£
```python
intent = self.llm.analyze_query_intent(query)
# è¿”å›: {intent_type, granularity, complexity, needs_multi_doc}
```

### 3. åŠ¨æ€å­æŸ¥è¯¢ç”Ÿæˆ

**ä¹‹å‰:** ç®€å•åˆ†å‰²
```python
subqueries = query.split("å’Œ")
```

**ç°åœ¨:** æ™ºèƒ½åˆ†è§£
```python
subqueries = self.llm.generate_subqueries(query, max_subqueries=3)
# LLMç†è§£æŸ¥è¯¢è¯­ä¹‰ï¼Œç”Ÿæˆæœ€ä¼˜å­æŸ¥è¯¢
```

### 4. é«˜è´¨é‡æŠ¥å‘Šç”Ÿæˆ

**ä¹‹å‰:** ç®€å•æ‹¼æ¥
```python
report = "\n".join([r.content for r in results])
```

**ç°åœ¨:** æ™ºèƒ½ç»¼åˆ
```python
report = self.llm.generate_report(query, evidence_list, history)
# LLMç»¼åˆåˆ†æè¯æ®ï¼Œç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Š
```

## ğŸš€ ä½¿ç”¨æµç¨‹

### æ­¥éª¤1: æµ‹è¯•APIè¿æ¥

```bash
cd /mnt/user-data/outputs
python test_llm_api.py basic
```

**æœŸæœ›è¾“å‡º:**
```
âœ… è¿æ¥æˆåŠŸ!
å›å¤: è¿æ¥æˆåŠŸ
```

### æ­¥éª¤2: è¿è¡Œå®Œæ•´æµ‹è¯•

```bash
python test_llm_api.py
```

**æµ‹è¯•é¡¹ç›®:**
- åŸºæœ¬è¿æ¥ âœ…
- è¡¨æ ¼æè¿° âœ…
- æ‘˜è¦ç”Ÿæˆ âœ…
- æ„å›¾åˆ†æ âœ…
- å­æŸ¥è¯¢ç”Ÿæˆ âœ…
- æŠ¥å‘Šç”Ÿæˆ âœ…

### æ­¥éª¤3: ä½¿ç”¨å®Œæ•´ç³»ç»Ÿ

```python
from doc_researcher_with_llm import LLMDocResearcher

# åˆ›å»ºç³»ç»Ÿ
researcher = LLMDocResearcher()

# æ·»åŠ æ–‡æ¡£
researcher.add_documents(["paper1.pdf", "paper2.pdf"])

# æ‰§è¡Œç ”ç©¶ï¼ˆä¼šè°ƒç”¨çœŸå®LLM APIï¼‰
report = researcher.research("è¿™äº›æ–‡æ¡£çš„ä¸»è¦è´¡çŒ®æ˜¯ä»€ä¹ˆï¼Ÿ")
print(report)
```

## ğŸ“Š APIè°ƒç”¨ç»Ÿè®¡

### å•æ¬¡ç ”ç©¶æŸ¥è¯¢çš„APIè°ƒç”¨æ¬¡æ•°

1. **æ–‡æ¡£è§£æé˜¶æ®µ** (æ¯ä¸ªæ–‡æ¡£)
   - è¡¨æ ¼æè¿°: çº¦2-5æ¬¡
   - å›¾ç‰‡æè¿°: çº¦1-3æ¬¡
   - æ‘˜è¦ç”Ÿæˆ: 1æ¬¡
   - **å°è®¡: çº¦4-9æ¬¡/æ–‡æ¡£**

2. **æŸ¥è¯¢åˆ†æé˜¶æ®µ**
   - æ„å›¾åˆ†æ: 1æ¬¡
   - å­æŸ¥è¯¢ç”Ÿæˆ: 1æ¬¡
   - **å°è®¡: 2æ¬¡**

3. **è¿­ä»£æ£€ç´¢é˜¶æ®µ** (æ¯æ¬¡è¿­ä»£)
   - å……åˆ†æ€§è¯„ä¼°: 1æ¬¡
   - æ–°å­æŸ¥è¯¢ç”Ÿæˆ: 0-1æ¬¡
   - **å°è®¡: 1-2æ¬¡/è¿­ä»£**

4. **æŠ¥å‘Šç”Ÿæˆé˜¶æ®µ**
   - æŠ¥å‘Šç”Ÿæˆ: 1æ¬¡
   - **å°è®¡: 1æ¬¡**

**æ€»è®¡:** çº¦10-25æ¬¡APIè°ƒç”¨/æŸ¥è¯¢ï¼ˆå–å†³äºæ–‡æ¡£æ•°å’Œè¿­ä»£æ¬¡æ•°ï¼‰

## ğŸ’° æˆæœ¬ä¼˜åŒ–å»ºè®®

### 1. ç¼“å­˜ç­–ç•¥

```python
# ç¼“å­˜æ–‡æ¡£æ‘˜è¦ï¼ˆä¸éœ€è¦é‡å¤ç”Ÿæˆï¼‰
summary_cache = {}

def get_summary(doc_id, text):
    if doc_id not in summary_cache:
        summary_cache[doc_id] = llm.generate_summary(text)
    return summary_cache[doc_id]
```

### 2. æ‰¹é‡å¤„ç†

```python
# æ‰¹é‡å¤„ç†å¤šä¸ªè¡¨æ ¼
tables = [...]
descriptions = []
for table in tables:
    descriptions.append(llm.generate_table_description(table))
```

### 3. è°ƒæ•´è¿­ä»£æ¬¡æ•°

```python
# æ ¹æ®æŸ¥è¯¢å¤æ‚åº¦è°ƒæ•´
simple_researcher = LLMDocResearcher(max_iterations=2)
complex_researcher = LLMDocResearcher(max_iterations=5)
```

### 4. ä½¿ç”¨è¾ƒçŸ­çš„max_tokens

```python
# å¯¹äºç®€å•ä»»åŠ¡
response = client.chat(messages, max_tokens=500)  # è€Œä¸æ˜¯2000
```

## ğŸ”„ ä¸åŸå§‹å®ç°çš„å¯¹æ¯”

| åŠŸèƒ½ | åŸå§‹å®ç° | LLMé›†æˆç‰ˆ |
|------|---------|----------|
| è¡¨æ ¼æè¿° | å›ºå®šæ¨¡æ¿ | LLMåŠ¨æ€ç”Ÿæˆ |
| æ–‡æ¡£æ‘˜è¦ | ç®€å•æˆªå– | LLMæ™ºèƒ½æ¦‚æ‹¬ |
| æ„å›¾åˆ†æ | å…³é”®è¯åŒ¹é… | LLMæ·±åº¦ç†è§£ |
| å­æŸ¥è¯¢ | ç®€å•åˆ†å‰² | LLMæ™ºèƒ½åˆ†è§£ |
| å……åˆ†æ€§è¯„ä¼° | è®¡æ•°é€»è¾‘ | LLMè¯­ä¹‰è¯„ä¼° |
| æŠ¥å‘Šç”Ÿæˆ | æ–‡æœ¬æ‹¼æ¥ | LLMç»¼åˆåˆ†æ |
| **è´¨é‡** | â­â­â­ | â­â­â­â­â­ |
| **çµæ´»æ€§** | ä½ | é«˜ |
| **æˆæœ¬** | æ—  | æœ‰APIè°ƒç”¨æˆæœ¬ |

## ğŸ“ å­¦ä¹ ä»·å€¼

è¿™ä¸ªå®ç°å±•ç¤ºäº†:

1. **å¦‚ä½•å°è£…LLM API**
   - ç»Ÿä¸€æ¥å£è®¾è®¡
   - é”™è¯¯å¤„ç†å’Œé‡è¯•
   - æç¤ºè¯å·¥ç¨‹

2. **å¦‚ä½•é›†æˆLLMåˆ°å¤æ‚ç³»ç»Ÿ**
   - æ¨¡å—åŒ–è®¾è®¡
   - æ¸è¿›å¼æ›¿æ¢
   - ä¿æŒå‘åå…¼å®¹

3. **LLMåº”ç”¨çš„æœ€ä½³å®è·µ**
   - æ˜ç¡®çš„æç¤ºè¯
   - ç»“æ„åŒ–è¾“å‡º
   - é”™è¯¯æ¢å¤

4. **ç”Ÿäº§çº§ä»£ç æ ‡å‡†**
   - å®Œæ•´çš„æ–‡æ¡£
   - å…¨é¢çš„æµ‹è¯•
   - æ¸…æ™°çš„æ¥å£

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºç¡€LLMè°ƒç”¨

```python
from llm_client import LLMClient

client = LLMClient()

# ç”Ÿæˆè¡¨æ ¼æè¿°
table = "| A | B |\n|---|---|\n| 1 | 2 |"
desc = client.generate_table_description(table)
print(desc)
```

### ç¤ºä¾‹2: å®Œæ•´ç ”ç©¶æµç¨‹

```python
from doc_researcher_with_llm import LLMDocResearcher

researcher = LLMDocResearcher(max_iterations=3)
researcher.add_documents(["doc1.pdf", "doc2.pdf"])

# ç¬¬ä¸€è½®æŸ¥è¯¢
report1 = researcher.research("ä¸»è¦å‘ç°æ˜¯ä»€ä¹ˆï¼Ÿ")

# ç¬¬äºŒè½®æŸ¥è¯¢ï¼ˆåŸºäºå†å²ï¼‰
report2 = researcher.research("èƒ½è¯¦ç»†è¯´æ˜ç¬¬ä¸€ä¸ªå‘ç°å—ï¼Ÿ")
```

### ç¤ºä¾‹3: è‡ªå®šä¹‰LLMå‚æ•°

```python
from llm_client import LLMClient

# åˆ›å»ºè‡ªå®šä¹‰å®¢æˆ·ç«¯
client = LLMClient(
    timeout=600,      # 10åˆ†é’Ÿè¶…æ—¶
    max_retries=5     # æœ€å¤šé‡è¯•5æ¬¡
)

# ä½¿ç”¨ç‰¹å®šå‚æ•°è°ƒç”¨
response = client.chat(
    messages=[...],
    temperature=0.7,  # æ›´æœ‰åˆ›æ„
    max_tokens=1000   # é™åˆ¶é•¿åº¦
)
```

## ğŸ”— ç›¸å…³é“¾æ¥

- APIæ–‡æ¡£: è¯·å’¨è¯¢æ‚¨çš„APIæä¾›æ–¹
- Qwenæ¨¡å‹: https://github.com/QwenLM/Qwen
- åŸå§‹è®ºæ–‡: arXiv:2510.21603

## âœ¨ æ€»ç»“

**å®Œæˆæƒ…å†µ:**
- âœ… LLMå®¢æˆ·ç«¯å®Œæ•´å°è£…
- âœ… ç³»ç»Ÿå…¨é¢é›†æˆLLM
- âœ… å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
- âœ… è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£

**ä»£ç è´¨é‡:**
- âœ… æ¸…æ™°çš„ä¸­æ–‡æ³¨é‡Š
- âœ… æ¨¡å—åŒ–è®¾è®¡
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… å¯æ‰©å±•çš„æ¶æ„

**å¯ç”¨æ€§:**
- âœ… å³å¼€å³ç”¨
- âœ… è¯¦ç»†æ–‡æ¡£
- âœ… æµ‹è¯•å·¥å…·
- âœ… ç¤ºä¾‹ä»£ç 

ç°åœ¨æ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé›†æˆäº†çœŸå®LLM APIçš„Doc-Researcherç³»ç»Ÿï¼ğŸ‰
